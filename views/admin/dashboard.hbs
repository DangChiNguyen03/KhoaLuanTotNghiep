{{#section 'title'}}Dashboard - Thống kê doanh số{{/section}}

<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2><i class="fas fa-chart-bar me-2"></i>Dashboard - Thống kê doanh số</h2>
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
                        <li class="breadcrumb-item active">Thống kê</li>
                    </ol>
                </nav>
            </div>

            {{> messages}}

            <!-- Thống kê tổng quan -->
            <div class="row mb-4">
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-primary shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                        Tổng doanh thu
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">
                                        {{formatPrice totalStats.totalRevenue}}
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-success shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                        Tổng đơn hàng
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">
                                        {{totalStats.totalOrders}}
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-shopping-cart fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-info shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                        Khách hàng
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">
                                        {{totalStats.totalCustomers}}
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-users fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card border-left-warning shadow h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                        Sản phẩm
                                    </div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">
                                        {{totalStats.totalProducts}}
                                    </div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-box fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Thống kê theo thời gian -->
            <div class="row mb-4">
                <div class="col-lg-6">
                    <div class="card shadow">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">
                                <i class="fas fa-calendar-alt me-2"></i>Doanh thu theo thời gian
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-borderless">
                                    <thead>
                                        <tr>
                                            <th>Thời gian</th>
                                            <th>Doanh thu</th>
                                            <th>Đơn hàng</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td><i class="fas fa-calendar-day text-primary me-2"></i>Hôm nay</td>
                                            <td><strong class="text-success">{{formatPrice timeStats.today.revenue}}</strong></td>
                                            <td><span class="badge bg-primary">{{timeStats.today.orders}}</span></td>
                                        </tr>
                                        <tr>
                                            <td><i class="fas fa-calendar-week text-info me-2"></i>Tuần này</td>
                                            <td><strong class="text-success">{{formatPrice timeStats.thisWeek.revenue}}</strong></td>
                                            <td><span class="badge bg-info">{{timeStats.thisWeek.orders}}</span></td>
                                        </tr>
                                        <tr>
                                            <td><i class="fas fa-calendar-alt text-warning me-2"></i>Tháng này</td>
                                            <td><strong class="text-success">{{formatPrice timeStats.thisMonth.revenue}}</strong></td>
                                            <td><span class="badge bg-warning">{{timeStats.thisMonth.orders}}</span></td>
                                        </tr>
                                        <tr>
                                            <td><i class="fas fa-calendar text-secondary me-2"></i>Năm này</td>
                                            <td><strong class="text-success">{{formatPrice timeStats.thisYear.revenue}}</strong></td>
                                            <td><span class="badge bg-secondary">{{timeStats.thisYear.orders}}</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-6">
                    <div class="card shadow">
                        <div class="card-header py-3">
                            <h6 class="m-0 font-weight-bold text-primary">
                                <i class="fas fa-trophy me-2"></i>Top 5 sản phẩm bán chạy
                            </h6>
                        </div>
                        <div class="card-body">
                            {{#if topProducts.length}}
                            <div class="table-responsive">
                                <table class="table table-borderless">
                                    <thead>
                                        <tr>
                                            <th>#</th>
                                            <th>Sản phẩm</th>
                                            <th>Đã bán</th>
                                            <th>Doanh thu</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {{#each topProducts}}
                                        <tr>
                                            <td>
                                                {{#if (eq @index 0)}}
                                                <i class="fas fa-trophy text-warning"></i>
                                                {{else if (eq @index 1)}}
                                                <i class="fas fa-medal text-secondary"></i>
                                                {{else if (eq @index 2)}}
                                                <i class="fas fa-medal text-warning"></i>
                                                {{else}}
                                                <span class="text-muted">{{add @index 1}}</span>
                                                {{/if}}
                                            </td>
                                            <td><strong>{{this.name}}</strong></td>
                                            <td><span class="badge bg-success">{{this.count}}</span></td>
                                            <td class="text-success">{{formatPrice this.revenue}}</td>
                                        </tr>
                                        {{/each}}
                                    </tbody>
                                </table>
                            </div>
                            {{else}}
                            <div class="text-center py-4">
                                <i class="fas fa-chart-bar fa-3x text-muted mb-3"></i>
                                <p class="text-muted">Chưa có dữ liệu bán hàng</p>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Đơn hàng gần đây -->
            <div class="row">
                <div class="col-12">
                    <div class="card shadow">
                        <div class="card-header py-3 d-flex justify-content-between align-items-center">
                            <h6 class="m-0 font-weight-bold text-primary">
                                <i class="fas fa-list me-2"></i>Đơn hàng gần đây
                            </h6>
                            <a href="/admin/orders" class="btn btn-primary btn-sm">
                                <i class="fas fa-eye me-1"></i>Xem tất cả
                            </a>
                        </div>
                        <div class="card-body">
                            {{#if recentOrders.length}}
                            <div class="table-responsive">
                                <table class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Mã đơn</th>
                                            <th>Khách hàng</th>
                                            <th>Sản phẩm</th>
                                            <th>Tổng tiền</th>
                                            <th>Thanh toán</th>
                                            <th>Trạng thái</th>
                                            <th>Ngày đặt</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {{#each recentOrders}}
                                        <tr>
                                            <td><code>#{{substring this._id 0 8}}</code></td>
                                            <td>
                                                <strong>{{this.user.name}}</strong>
                                                <br><small class="text-muted">{{this.user.email}}</small>
                                            </td>
                                            <td>
                                                <small>
                                                    {{#each this.items}}
                                                    {{this.product.name}} ({{this.quantity}}){{#unless @last}}, {{/unless}}
                                                    {{/each}}
                                                </small>
                                            </td>
                                            <td><strong class="text-success">{{formatPrice this.totalPrice}}</strong></td>
                                            <td>
                                                <span class="badge {{#if (eq this.paymentMethod 'cash')}}bg-success{{else}}bg-info{{/if}}">
                                                    {{#if (eq this.paymentMethod 'cash')}}Tiền mặt{{else}}Chuyển khoản{{/if}}
                                                </span>
                                            </td>
                                            <td>
                                                 <span class="badge 
                                                     {{#if (eq this.status 'completed')}}bg-success
                                                     {{else if (eq this.status 'cancelled')}}bg-danger
                                                     {{else if (eq this.status 'pending')}}bg-warning
                                                     {{else if (eq this.status 'confirmed')}}bg-info
                                                     {{else if (eq this.status 'preparing')}}bg-warning
                                                     {{else if (eq this.status 'ready')}}bg-primary
                                                     {{else}}bg-secondary{{/if}}">
                                                     {{#if (eq this.status 'completed')}}Hoàn thành
                                                     {{else if (eq this.status 'cancelled')}}Đã hủy
                                                     {{else if (eq this.status 'pending')}}Đang xử lý
                                                     {{else if (eq this.status 'confirmed')}}Đã xác nhận
                                                     {{else if (eq this.status 'preparing')}}Đang chuẩn bị
                                                     {{else if (eq this.status 'ready')}}Sẵn sàng
                                                     {{else}}{{this.status}}{{/if}}
                                                </span>
                                            </td>
                                            <td><small>{{formatDateTime this.createdAt}}</small></td>
                                        </tr>
                                        {{/each}}
                                    </tbody>
                                </table>
                            </div>
                            {{else}}
                            <div class="text-center py-5">
                                <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                                <h5 class="text-muted">Chưa có đơn hàng nào</h5>
                            </div>
                            {{/if}}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.border-left-primary {
    border-left: 0.25rem solid #4e73df !important;
}
.border-left-success {
    border-left: 0.25rem solid #1cc88a !important;
}
.border-left-info {
    border-left: 0.25rem solid #36b9cc !important;
}
.border-left-warning {
    border-left: 0.25rem solid #f6c23e !important;
}
.text-xs {
    font-size: 0.7rem;
}
.text-gray-300 {
    color: #dddfeb !important;
}
.text-gray-800 {
    color: #5a5c69 !important;
}
</style>
